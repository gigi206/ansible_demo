---
# tasks file for myapp

- name: MyAPP
  tags: MyAPP
  block:
    # - name: Install demo app
    #   ansible.builtin.include_tasks: "{{ role_path }}/tasks/install/demo.yaml"
    #   tags: demo_install_demo_app


    # - name: Install all requirements packages
    #   ansible.builtin.package:
    #     name: "{{ packages }}"
    #     state: present

    # - name: Check if var file exists
    #   stat:
    #     path: "{{ role_path }}/vars/{{ item }}"
    #   register: register_name
    #   loop:
    #     - default.yml
    #     - "{{ ansible_os_family }}.yml"
    #     - "{{ ansible_distribution }}.yml"
    #     - "{{ ansible_distribution }}{{ ansible_distribution_version }}.yml"

    - name: Test
      ansible.builtin.include_vars: "{{ item }}"
      loop:
        - default.yml
        - "{{ ansible_os_family }}.yml"
        - "{{ ansible_distribution }}.yml"
        - "{{ ansible_distribution }}{{ ansible_distribution_version }}.yml"
      when:
        - role_path + "/vars/" + item in query("ansible.builtin.fileglob", "{}/vars/*.yml".format(role_path))


    - name: Debugging
      ansible.builtin.debug:
        var: myvar
        # var: query("ansible.builtin.fileglob", "{{role_path}}/vars/*.yml")



    # - name: Load a variable file based on the OS type, or a default if not found. Using free-form to specify the file.
    #   ansible.builtin.include_vars: "{{ lookup('ansible.builtin.first_found', params) }}"
    #   vars:
    #     params:
    #       files:
    #         - "{{ ansible_distribution }}{{ ansible_distribution }}.yaml"
    #         - "{{ ansible_distribution }}.yaml"
    #         - "{{ ansible_os_family }}.yaml"
    #         - default.yaml
    #       paths:
    #         - 'vars'